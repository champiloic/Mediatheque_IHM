<!DOCTYPE html>
<html lang="fr">
<head>
    <title>Détails du Livre</title>
    <link rel="stylesheet" href="detail.css">
    <style>
        #book-details {
            display: flex;
            align-items: flex-start;
            gap: 20px;
        }
        .book-cover {
            max-width: 200px;
            height: auto;
        }
        .book-info {
            flex: 1;
        }
    </style>
</head>
<body>
    <img src="./logo.png" alt="Logo" class="logo">
    <div id="book-details">
        <p>Chargement des détails...</p>
    </div>
    <div id="add-to-list-container">
        <button id="addToListBtn">A lire</button>
        <select id="userLists" style="display: none;"></select>
    </div>
    <script>
        async function fetchBookDetails() {
            // Récupérer la clé du livre depuis l'URL
            const params = new URLSearchParams(window.location.search);
            const key = params.get('key');

            if (!key) {
                document.getElementById('book-details').innerHTML = '<p>Aucun livre sélectionné.</p>';
                return;
            }

            try {
                // Appeler l'API OpenLibrary pour récupérer les détails du livre
                const response = await fetch(`https://openlibrary.org${key}.json`);
                if (!response.ok) {
                    throw new Error('Erreur lors de la récupération des détails du livre');
                }

                const book = await response.json();

                // Extraire les informations nécessaires
                const title = book.title || 'Titre inconnu';
                const description = book.description
                    ? (typeof book.description === 'string' ? book.description : book.description.value)
                    : 'Description non disponible';
                const authors = book.authors
                    ? await Promise.all(book.authors.map(async (author) => {
                        const authorResponse = await fetch(`https://openlibrary.org${author.author.key}.json`);
                        const authorData = await authorResponse.json();
                        return authorData.name;
                    }))
                    : ['Auteur inconnu'];

                const coverImage = book.covers ? `https://covers.openlibrary.org/b/id/${book.covers[0]}-L.jpg` : './placeholder.png';

                // Fetch availability information
                const availabilityResponse = await fetch(`https://openlibrary.org${key}/availability.json`);
                const availabilityData = availabilityResponse.ok ? await availabilityResponse.json() : null;
                const availability = availabilityData && availabilityData.status === 'available' ? 'Disponible' : 'Non disponible';

                // Afficher les informations dans la page
                document.getElementById('book-details').innerHTML = `
                    <img src="${coverImage}" alt="Couverture du livre" class="book-cover">
                    <div class="book-info">
                        <h1>${title}</h1>
                        <p><strong>Auteur(s):</strong> ${authors.join(', ')}</p>
                        <p><strong>Description:</strong> ${description}</p>
                        <p><strong>Disponibilité:</strong> ${availability}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('book-details').innerHTML = '<p>Erreur lors de la récupération des détails du livre.</p>';
            }
        }
        // Appeler la fonction pour récupérer les détails du livre
        fetchBookDetails();
    </script>
</body>
</html>